#!/bin/bash
awk '{
	delta = match($0, /\$D/)
	if(delta){
		print $1"\t" $2, -($3), $4, $5
		if($6 || $7 || $8 || $9)
			print "\t" $6, -($7), $8, $9
		if($10 || $11 || $12 || $13)
			print "\t" $10, -($11), $12, $13
		if($14 || $15 || $16 || $17)
			print "\t" $14, -($15), $16, $17
		if($18 || $19 || $20 || $21) 
			print "\t" $18, -($19), $20, $21
		if($22 || $23 || $24 || $25) 
			print "\t" $22, -($23), $24, $25
		if($26 || $27 || $28 || $29) 
			print "\t" $26, -($27), $28, $29
		if($30 || $31 || $32 || $33)
			print "\t" $30, -($31), $32, $33
	} else {
		rects = match($0, /\$(A|R|C)/)
		if(rects) {
			print $1"\t" $2, 300-($3+$5), $4, $5
			if($6 || $7 || $8 || $9)
				print "\t" $6, 300-($7+$9), $8, $9
			if($10 || $11 || $12 || $13)
				print "\t" $10, 300-($11+$13), $12, $13
			if($14 || $15 || $16 || $17)
				print "\t" $14, 300-($15+$17), $16, $17
			if($18 || $19 || $20 || $21) 
				print "\t" $18, 300-($19+$21), $20, $21
			if($22 || $23 || $24 || $25) 
				print "\t" $22, 300-($23+$25), $24, $25
			if($26 || $27 || $28 || $29) 
				print "\t" $26, 300-($27+$29), $28, $29
			if($30 || $31 || $32 || $33)
				print "\t" $30, 300-($31+$33), $32, $33
		} else {
			print $0
		}
	}
}' $1 > $1.flp

sed ':a;N;$!ba;s/\n\t/\t/g' $1.flp | sed ':a;N;$!ba;s/\n\ /\ /g' > $1

rm $1.flp
